<h3 class="text-left">{%= __("HOTEL DAILY INN") %}</h3>

<p class="text-left">{%= __("Jl. Jenderal Ahmad Yani Kavling 67 Cempaka Putih Timur, Jakarta Pusat") %}</p>
<p class="text-left">{%= __("Jakarta Indonesia. 10510") %}</p>
<p class="text-left">{%= __("Phone: 021-21473999 Fax: 021-21473998") %}</p>

<hr>

<h3 class="text-center">{%= __("Profit and Loss") %}</h3>

<h5 class="text-center">
	{%= frappe.datetime.str_to_user(filters.date) %}
</h5>

<table class="table">
	<thead>
		<tr>
			<th style="width: 40%;">{%= __("Account") %}</th>
			<th style="width: 20%;">{%= __("Current Month") %}</th>
			<th style="width: 20%;">{%= __("Last Month") %}</th>
			<th style="width: 20%;">{%= __("Year to Date") %}</th>
		</tr>
    </thead>
    <tbody>
        {% var r_cm = 0 %}
        {% var r_lm = 0 %}
        {% var r_yd = 0 %}

        <tr>
            <td><b>{%= __("Revenue") %}</b></td>    
            <td></td><td></td><td></td>
        </tr>

        {% for(var i=0, l=data.length-1; i<l; i++) { %}
            {% if (data[i].hierarki_ketiga == 'True' && (data[i].current_month != 0 || data[i].last_month != 0 || data[i].year_to_date != 0)) { %}
                {% if (data[i].account.substr(0, 1) == 4) { %}
                    <tr>
                        <td>{%= data[i].account %}</td>
                        <td>{%= format_currency(data[i].current_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].last_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].year_to_date, "IDR") %}</td>
                    </tr>

                    {% var r_cm = r_cm + data[i].cm %}
                    {% var r_lm = r_lm + data[i].lm %}
                    {% var r_yd = r_yd + data[i].yd %}
                {% } %}
            {% } %}
        {% } %}

        <tr>
            <td><b>{%= __("Total Revenue") %}</b></td>
            
            {% if (r_cm < 0) { %}
                <td><b>{%= format_currency(-1 * r_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_cm, "IDR") %}</b></td>
            {% } %}

            {% if (r_lm < 0) { %}
                <td><b>{%= format_currency(-1 * r_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_lm, "IDR") %}</b></td>
            {% } %}

            {% if (r_yd < 0) { %}
                <td><b>{%= format_currency(-1 * r_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td>
        </tr>

        {% var cos_cm = 0 %}
        {% var cos_lm = 0 %}
        {% var cos_yd = 0 %}

        <tr>
            <td><b>{%= __("Cost of Sales") %}</b></td>    
            <td></td><td></td><td></td>
        </tr>

        {% for(var i=0, l=data.length-1; i<l; i++) { %}
            {% if (data[i].hierarki_ketiga == 'True' && (data[i].current_month != 0 || data[i].last_month != 0 || data[i].year_to_date != 0)) { %}
                {% if (data[i].account.substr(0, 1) == 5) { %}
                    <tr>
                        <td>{%= data[i].account %}</td>
                        <td>{%= format_currency(data[i].current_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].last_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].year_to_date, "IDR") %}</td>
                    </tr>

                    {% var cos_cm = cos_cm + data[i].cm %}
                    {% var cos_lm = cos_lm + data[i].lm %}
                    {% var cos_yd = cos_yd + data[i].yd %}
                {% } %}
            {% } %}
        {% } %}

        <tr>
            <td><b>{%= __("Total Cost of Sales") %}</b></td>

            {% if (cos_cm < 0) { %}
                <td><b>{%= format_currency(-1 * cos_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_cm, "IDR") %}</b></td>
            {% } %}

            {% if (cos_lm < 0) { %}
                <td><b>{%= format_currency(-1 * cos_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_lm, "IDR") %}</b></td>
            {% } %}

            {% if (cos_yd < 0) { %}
                <td><b>{%= format_currency(-1 * cos_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td>
        </tr>

        {% var ep_cm = 0 %}
        {% var ep_lm = 0 %}
        {% var ep_yd = 0 %}

        <tr>
            <td><b>{%= __("Employee and Payroll") %}</b></td>    
            <td></td><td></td><td></td>
        </tr>

        {% for(var i=0, l=data.length-1; i<l; i++) { %}
            {% if (data[i].hierarki_ketiga == 'True' && (data[i].current_month != 0 || data[i].last_month != 0 || data[i].year_to_date != 0)) { %}
                {% if (data[i].account.substr(0, 1) == 6) { %}
                    <tr>
                        <td>{%= data[i].account %}</td>
                        <td>{%= format_currency(data[i].current_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].last_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].year_to_date, "IDR") %}</td>
                    </tr>

                    {% var ep_cm = ep_cm + data[i].cm %}
                    {% var ep_lm = ep_lm + data[i].lm %}
                    {% var ep_yd = ep_yd + data[i].yd %}
                {% } %}
            {% } %}
        {% } %}

        <tr>
            <td><b>{%= __("Total Employee and Payroll") %}</b></td>

            {% if (ep_cm < 0) { %}
                <td><b>{%= format_currency(-1 * ep_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_cm, "IDR") %}</b></td>
            {% } %}

            {% if (ep_lm < 0) { %}
                <td><b>{%= format_currency(-1 * ep_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_lm, "IDR") %}</b></td>
            {% } %}

            {% if (ep_yd < 0) { %}
                <td><b>{%= format_currency(-1 * ep_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td>
        </tr>

        {% var e_cm = 0 %}
        {% var e_lm = 0 %}
        {% var e_yd = 0 %}

        <tr>
            <td><b>{%= __("Expense") %}</b></td>    
            <td></td><td></td><td></td>
        </tr>

        {% for(var i=0, l=data.length-1; i<l; i++) { %}
            {% if (data[i].hierarki_ketiga == 'True' && (data[i].current_month != 0 || data[i].last_month != 0 || data[i].year_to_date != 0)) { %}
                {% if (data[i].account.substr(0, 1) == 7) { %}
                    <tr>
                        <td>{%= data[i].account %}</td>
                        <td>{%= format_currency(data[i].current_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].last_month, "IDR") %}</td>
                        <td>{%= format_currency(data[i].year_to_date, "IDR") %}</td>
                    </tr>

                    {% var e_cm = e_cm + data[i].cm %}
                    {% var e_lm = e_lm + data[i].lm %}
                    {% var e_yd = e_yd + data[i].yd %}
                {% } %}
            {% } %}
        {% } %}

        <tr>
            <td><b>{%= __("Total Expense") %}</b></td>

            {% if (e_cm < 0) { %}
                <td><b>{%= format_currency(-1 * e_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_cm, "IDR") %}</b></td>
            {% } %}

            {% if (e_lm < 0) { %}
                <td><b>{%= format_currency(-1 * e_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_lm, "IDR") %}</b></td>
            {% } %}

            {% if (e_yd < 0) { %}
                <td><b>{%= format_currency(-1 * e_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td>
        </tr>

        <tr>
            <td><b>{%= __("Summary") %}</b></td>
            <td></td><td></td><td></td>
        </tr>
        <tr>
            <td><b>{%= __("Total Revenue") %}</b></td>
            
            {% if (r_cm < 0) { %}
                <td><b>{%= format_currency(-1 * r_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_cm, "IDR") %}</b></td>
            {% } %}

            {% if (r_lm < 0) { %}
                <td><b>{%= format_currency(-1 * r_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_lm, "IDR") %}</b></td>
            {% } %}

            {% if (r_yd < 0) { %}
                <td><b>{%= format_currency(-1 * r_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(r_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td><b>{%= __("Total Cost of Sales") %}</b></td>

            {% if (cos_cm < 0) { %}
                <td><b>{%= format_currency(-1 * cos_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_cm, "IDR") %}</b></td>
            {% } %}

            {% if (cos_lm < 0) { %}
                <td><b>{%= format_currency(-1 * cos_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_lm, "IDR") %}</b></td>
            {% } %}

            {% if (cos_yd < 0) { %}
                <td><b>{%= format_currency(-1 * cos_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(cos_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        <tr>
            <td><b>{%= __("Total Employee and Payroll") %}</b></td>

            {% if (ep_cm < 0) { %}
                <td><b>{%= format_currency(-1 * ep_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_cm, "IDR") %}</b></td>
            {% } %}

            {% if (ep_lm < 0) { %}
                <td><b>{%= format_currency(-1 * ep_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_lm, "IDR") %}</b></td>
            {% } %}

            {% if (ep_yd < 0) { %}
                <td><b>{%= format_currency(-1 * ep_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(ep_yd, "IDR") %}</b></td>
            {% } %}
        </tr>

        {% var gop_cm = r_cm - cos_cm - ep_cm %}
        {% var gop_lm = r_lm - cos_lm - ep_lm %}
        {% var gop_yd = r_yd - cos_yd - ep_yd %}

        <tr>
            <td><b>{%= __("Gross Operating Profit (GOP)") %}</b></td>

            {% if (gop_cm < 0) { %}
                <td><b>{%= format_currency(-1 * gop_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(gop_cm, "IDR") %}</b></td>
            {% } %}

            {% if (gop_lm < 0) { %}
                <td><b>{%= format_currency(-1 * gop_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(gop_lm, "IDR") %}</b></td>
            {% } %}

            {% if (gop_yd < 0) { %}
                <td><b>{%= format_currency(-1 * gop_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(gop_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
        
        <tr>
            <td><b>{%= __("Total Expense") %}</b></td>

            {% if (e_cm < 0) { %}
                <td><b>{%= format_currency(-1 * e_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_cm, "IDR") %}</b></td>
            {% } %}

            {% if (e_lm < 0) { %}
                <td><b>{%= format_currency(-1 * e_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_lm, "IDR") %}</b></td>
            {% } %}

            {% if (e_yd < 0) { %}
                <td><b>{%= format_currency(-1 * e_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(e_yd, "IDR") %}</b></td>
            {% } %}
        </tr>

        {% var nop_cm = gop_cm - e_cm %}
        {% var nop_lm = gop_lm - e_lm %}
        {% var nop_yd = gop_yd - e_yd %}

        <tr>
            <td><b>{%= __("Net Operating Profit (NOP)") %}</b></td>

            {% if (nop_cm < 0) { %}
                <td><b>{%= format_currency(-1 * nop_cm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(nop_cm, "IDR") %}</b></td>
            {% } %}

            {% if (nop_lm < 0) { %}
                <td><b>{%= format_currency(-1 * nop_lm, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(nop_lm, "IDR") %}</b></td>
            {% } %}

            {% if (nop_yd < 0) { %}
                <td><b>{%= format_currency(-1 * nop_yd, "IDR") %}</b></td>
            {% } else { %}
                <td><b>{%= format_currency(nop_yd, "IDR") %}</b></td>
            {% } %}
        </tr>
    </tbody>
</table>